<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="reset.css">
    <link rel="stylesheet" href="style.css">
    <title>Document</title>
</head>
<body>
    <h1>submit your <br><span>dilemma's</span></h1>
    <div class="scan">
        <canvas id="qr" class="qr"></canvas>
        <p><a href="#" id="remoteUrl">Join!</a></p>
    </div>

<div class="status">
    <p class="devices" id="devices">No participants (yet)</p>
    <p class="submitted" id="submitted">test 2</p>
</div>


    <script src="/socket.io/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js" integrity="sha512-pUhApVQtLbnpLtJn6DuzDD5o2xtmLJnJ7oBoMsBnzOkVkpqofGLGPaBJ6ayD2zQe3lCgCibhJBi4cj5wAxwVKA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script>
    {

        let socket;
        let remoteUrl = document.getElementById('remoteUrl');


        const init = () => {
                        
            socket = io();

            socket.on('socket-id', (id) => {
            const urlParams = new URLSearchParams(window.location.search);
            urlParams.set('socketId', id);
            history.replaceState({}, '', `${window.location.pathname}?${urlParams.toString()}`);
            });
            
            

            socket.on('connect', () => {
                console.log(`Connected: ${socket.id}`);
                const ip = window.location.hostname;

                const url = `${new URL(`/remote.html?id=${socket.id}`, window.location)}`;

                remoteUrl.href = url;

                var qr = new QRious({
                element: document.getElementById('qr'),
                value: url,
                size: 400,
                background: 'transparent',
                foreground: '#E50809',
                level: 'L',
                });

                socket.emit('get-client-count');
                socket.on('client-count', (count) => {
                    console.log(`client-count: ${count}`);
                    if (count === 2) {
                        document.getElementById('devices').innerText = `${count-1} participant registered`;
                    } else {
                        document.getElementById('devices').innerText = `${count-1} participants registered`;
                    }

                    //max 10 participants
                    if (count === 11) {
                        document.getElementById('devices').innerText = `Max 10 participants reached`;
                    }

                });


                socket.on('options-updated', (options) => {
                    console.log('Options:', options);
                });
            }); 


    
    }; 

        init();

    }

    </script>
</body>
</html>